---
name: check-pr
description: main以外のブランチで作業開始時にPRを確認する。PRがなければDraft PRを作成。説明文が不足している場合や計画を立てた場合はPRを更新。作業完了時はDraftを正式PRに変換。「PRを確認」「計画をPRに反映」「PRを完了」などのリクエスト時に使用。
---

# Check PR

main以外のブランチで作業する際に、PRの説明文を確認・更新する。

## ワークフロー

### ステップ1: PRを取得

```bash
gh pr view --json number,title,body,url,isDraft
```

PRが存在しない場合はステップ1.1へ。

### ステップ1.1: PRがない場合はDraft PRを作成

コミットがない場合は空コミットを作成：

```bash
git commit --allow-empty -m "WIP"
git push -u origin HEAD
```

Draft PRを作成：

```bash
gh pr create --draft --title "[WIP] ブランチ名から推測したタイトル" --body "作業中"
```

### ステップ2: 説明文を確認

PRの説明文をチェック：

- 概要：何を実現するか、どのように実現するかが明確か
- 変更内容：具体的な変更点が記載されているか
- 動作確認：チェック項目があるか

### ステップ3: 不備があれば更新

不備がある場合は `AskUserQuestion` で端的に確認：

- 「このPRで何を実現しますか？どのように実現しますか？」
- 「動作確認はどうすればいいですか？」

確認後、`gh pr edit --body` で更新。

## 計画立案時の更新

作業中に計画を立てた場合、その計画をPRに反映する。

### 更新タイミング

- 実装方針が決まった時
- タスクを洗い出した時
- 設計を変更した時

### 更新内容

計画の内容を反映：

```bash
gh pr edit --body "$(cat <<'EOF'
[何を実現するか、どのように実現するかを簡潔に記載]

## 変更内容

- [計画で決まったタスク1]
- [計画で決まったタスク2]
- [計画で決まったタスク3]

## 動作確認

- [ ] [計画に基づく確認項目1]
- [ ] [計画に基づく確認項目2]

EOF
)"
```

## 作業完了時のDraft変換

Draft PRで作業が完了した場合、正式なPRに変換する。

### 変換フロー

`AskUserQuestion` で確認：

- 「作業が完了しました。Draft PRをReady for reviewに変換しますか？」

承認後、変換を実行：

```bash
gh pr ready
```

タイトルから `[WIP]` プレフィックスがあれば削除：

```bash
gh pr edit --title "新しいタイトル"
```

## PRテンプレート

```markdown
このPRで何を実現するか、どのように実現するかを簡潔に記載

## 変更内容

- 変更点1
- 変更点2

## 動作確認

- [ ] 対象機能が正しく動作する
- [ ] 既存機能に影響がない
- [ ] ビルドが通る
```
